import{o as j}from"./robust-predicates-DArCjZZA.js";const Y=Math.pow(2,-52),q=new Uint32Array(512);class C{static from(t,n=Q,l=V){const r=t.length,h=new Float64Array(r*2);for(let i=0;i<r;i++){const o=t[i];h[2*i]=n(o),h[2*i+1]=l(o)}return new C(h)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const l=Math.max(2*n-5,0);this._triangles=new Uint32Array(l*3),this._halfedges=new Int32Array(l*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:l,_hullTri:r,_hullHash:h}=this,i=t.length>>1;let o=1/0,f=1/0,g=-1/0,m=-1/0;for(let e=0;e<i;e++){const u=t[2*e],a=t[2*e+1];u<o&&(o=u),a<f&&(f=a),u>g&&(g=u),a>m&&(m=a),this._ids[e]=e}const d=(o+g)/2,b=(f+m)/2;let c,y,w;for(let e=0,u=1/0;e<i;e++){const a=X(d,b,t[2*e],t[2*e+1]);a<u&&(c=e,u=a)}const T=t[2*c],U=t[2*c+1];for(let e=0,u=1/0;e<i;e++){if(e===c)continue;const a=X(T,U,t[2*e],t[2*e+1]);a<u&&a>0&&(y=e,u=a)}let M=t[2*y],k=t[2*y+1],G=1/0;for(let e=0;e<i;e++){if(e===c||e===y)continue;const u=B(T,U,M,k,t[2*e],t[2*e+1]);u<G&&(w=e,G=u)}let L=t[2*w],E=t[2*w+1];if(G===1/0){for(let a=0;a<i;a++)this._dists[a]=t[2*a]-t[0]||t[2*a+1]-t[1];D(this._ids,this._dists,0,i-1);const e=new Uint32Array(i);let u=0;for(let a=0,x=-1/0;a<i;a++){const A=this._ids[a],S=this._dists[A];S>x&&(e[u++]=A,x=S)}this.hull=e.subarray(0,u),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(j(T,U,M,k,L,E)<0){const e=y,u=M,a=k;y=w,M=L,k=E,w=e,L=u,E=a}const N=J(T,U,M,k,L,E);this._cx=N.x,this._cy=N.y;for(let e=0;e<i;e++)this._dists[e]=X(t[2*e],t[2*e+1],N.x,N.y);D(this._ids,this._dists,0,i-1),this._hullStart=c;let P=3;l[c]=n[w]=y,l[y]=n[c]=w,l[w]=n[y]=c,r[c]=0,r[y]=1,r[w]=2,h.fill(-1),h[this._hashKey(T,U)]=c,h[this._hashKey(M,k)]=y,h[this._hashKey(L,E)]=w,this.trianglesLen=0,this._addTriangle(c,y,w,-1,-1,-1);for(let e=0,u,a;e<this._ids.length;e++){const x=this._ids[e],A=t[2*x],S=t[2*x+1];if(e>0&&Math.abs(A-u)<=Y&&Math.abs(S-a)<=Y||(u=A,a=S,x===c||x===y||x===w))continue;let z=0;for(let H=0,F=this._hashKey(A,S);H<this._hashSize&&(z=h[(F+H)%this._hashSize],!(z!==-1&&z!==l[z]));H++);z=n[z];let _=z,p;for(;p=l[_],j(A,S,t[2*_],t[2*_+1],t[2*p],t[2*p+1])>=0;)if(_=p,_===z){_=-1;break}if(_===-1)continue;let K=this._addTriangle(_,x,l[_],-1,-1,r[_]);r[x]=this._legalize(K+2),r[_]=K,P++;let I=l[_];for(;p=l[I],j(A,S,t[2*I],t[2*I+1],t[2*p],t[2*p+1])<0;)K=this._addTriangle(I,x,p,r[x],-1,r[I]),r[x]=this._legalize(K+2),l[I]=I,P--,I=p;if(_===z)for(;p=n[_],j(A,S,t[2*p],t[2*p+1],t[2*_],t[2*_+1])<0;)K=this._addTriangle(p,x,_,-1,r[_],r[p]),this._legalize(K+2),r[p]=K,l[_]=_,P--,_=p;this._hullStart=n[x]=_,l[_]=n[I]=x,l[x]=I,h[this._hashKey(A,S)]=x,h[this._hashKey(t[2*_],t[2*_+1])]=_}this.hull=new Uint32Array(P);for(let e=0,u=this._hullStart;e<P;e++)this.hull[e]=u,u=l[u];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(O(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:l,coords:r}=this;let h=0,i=0;for(;;){const o=l[t],f=t-t%3;if(i=f+(t+2)%3,o===-1){if(h===0)break;t=q[--h];continue}const g=o-o%3,m=f+(t+1)%3,d=g+(o+2)%3,b=n[i],c=n[t],y=n[m],w=n[d];if(R(r[2*b],r[2*b+1],r[2*c],r[2*c+1],r[2*y],r[2*y+1],r[2*w],r[2*w+1])){n[t]=w,n[o]=b;const U=l[d];if(U===-1){let k=this._hullStart;do{if(this._hullTri[k]===d){this._hullTri[k]=t;break}k=this._hullPrev[k]}while(k!==this._hullStart)}this._link(t,U),this._link(o,l[i]),this._link(i,d);const M=g+(o+1)%3;h<q.length&&(q[h++]=M)}else{if(h===0)break;t=q[--h]}}return i}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,l,r,h,i){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=n,this._triangles[o+2]=l,this._link(o,r),this._link(o+1,h),this._link(o+2,i),this.trianglesLen+=3,o}}function O(s,t){const n=s/(Math.abs(s)+Math.abs(t));return(t>0?3-n:1+n)/4}function X(s,t,n,l){const r=s-n,h=t-l;return r*r+h*h}function R(s,t,n,l,r,h,i,o){const f=s-i,g=t-o,m=n-i,d=l-o,b=r-i,c=h-o,y=f*f+g*g,w=m*m+d*d,T=b*b+c*c;return f*(d*T-w*c)-g*(m*T-w*b)+y*(m*c-d*b)<0}function B(s,t,n,l,r,h){const i=n-s,o=l-t,f=r-s,g=h-t,m=i*i+o*o,d=f*f+g*g,b=.5/(i*g-o*f),c=(g*m-o*d)*b,y=(i*d-f*m)*b;return c*c+y*y}function J(s,t,n,l,r,h){const i=n-s,o=l-t,f=r-s,g=h-t,m=i*i+o*o,d=f*f+g*g,b=.5/(i*g-o*f),c=s+(g*m-o*d)*b,y=t+(i*d-f*m)*b;return{x:c,y}}function D(s,t,n,l){if(l-n<=20)for(let r=n+1;r<=l;r++){const h=s[r],i=t[h];let o=r-1;for(;o>=n&&t[s[o]]>i;)s[o+1]=s[o--];s[o+1]=h}else{const r=n+l>>1;let h=n+1,i=l;v(s,r,h),t[s[n]]>t[s[l]]&&v(s,n,l),t[s[h]]>t[s[l]]&&v(s,h,l),t[s[n]]>t[s[h]]&&v(s,n,h);const o=s[h],f=t[o];for(;;){do h++;while(t[s[h]]<f);do i--;while(t[s[i]]>f);if(i<h)break;v(s,h,i)}s[n+1]=s[i],s[i]=o,l-h+1>=i-n?(D(s,t,h,l),D(s,t,n,i-1)):(D(s,t,n,i-1),D(s,t,h,l))}}function v(s,t,n){const l=s[t];s[t]=s[n],s[n]=l}function Q(s){return s[0]}function V(s){return s[1]}export{C as D};
